import {
    Button,
    VerticalBox,
    GroupBox,
    CheckBox,
    ListView,
    HorizontalBox,
    LineEdit,
    ScrollView,
    StandardListView,
} from "std-widgets.slint";
import "../font/NotoSansSC-Regular.ttf";

export component AppWindow inherits Window {
    default-font-family: "Noto Sans SC";
    title: "File Cleaner";
    width: 900px;
    height: 700px;

    in-out property <string> selected_directory;
    in-out property <bool> org_enabled;
    in-out property <bool> html_enabled;
    in-out property <bool> dsstore_enabled;
    in-out property <string> action_text;
    in-out property <[string]> scan_results;

    // è·¯å¾„ä¸Žæ–‡ä»¶å¤¹é€»è¾‘
    in-out property <[string]> current_path_parts;
    in-out property <[string]> folder_list;
    callback choose_dir();
    callback action_clicked();
    callback path_part_clicked(int);
    callback folder_clicked(string);

    VerticalBox {
        padding: 16px;
        spacing: 16px;

        // 1. é¡¶éƒ¨å¯¼èˆªåŒºåŸŸ
        GroupBox {
            title: "Current Location";
            vertical-stretch: 0;

            HorizontalBox {
                padding: 4px;
                alignment: start;
                spacing: 4px;
                for path_part[i] in current_path_parts: Button {
                    text: path_part;
                    height: 28px;
                    clicked => {
                        path_part_clicked(i);
                    }
                }
            }
        }

        // 2. ä¸­é—´å†…å®¹åŒºåŸŸ
        HorizontalBox {
            spacing: 16px;
            vertical-stretch: 1;

            // å·¦ä¾§ï¼šç›®å½•é€‰æ‹©
            GroupBox {
                title: "Select Directory";
                horizontal-stretch: 1;
                vertical-stretch: 1;

                ListView {
                    for item in folder_list: Rectangle {
                        // å…³é”®ä¿®å¤ï¼šæ˜¾å¼æŒ‡å®šå®½åº¦å’Œé«˜åº¦
                        height: 30px;
                        width: parent.width; 
                        
                        // èƒŒæ™¯è‰²é€»è¾‘ï¼šæŒ‰ä¸‹å˜æ·±ç°ï¼Œæ‚¬åœå˜æµ…ç°ï¼Œé»˜è®¤é€æ˜Ž
                        background: area.pressed ? #d0d0d0 : (area.has-hover ? #e8e8e8 : transparent);
                        border-radius: 4px;

                        // è§¦æ‘¸/ç‚¹å‡»åŒºåŸŸ
                        area := TouchArea {
                            clicked => {
                                root.folder_clicked(item);
                            }
                        }

                        // æ–‡æœ¬ç›´æŽ¥ä½œä¸º Rectangle çš„å­å…ƒç´ ï¼Œä¸ä½¿ç”¨ HorizontalBox
                        Text {
                            text: "ðŸ“ " + item;
                            color: #222222; // æ˜¾å¼é»‘è‰²
                            font-size: 14px;
                            
                            // å¸ƒå±€å®šä½
                            x: 8px;
                            vertical-alignment: center;
                            
                            // é˜²æ­¢æ–‡å­—è¿‡é•¿æº¢å‡º
                            overflow: elide;
                            width: parent.width - 16px;
                        }
                    }
                }
            }

            // å³ä¾§ï¼šæ‰«æç»“æžœ
            GroupBox {
                title: "Scan Results (" + scan_results.length + " items)";
                horizontal-stretch: 2;
                vertical-stretch: 1;

                ListView {
                    for item[i] in scan_results: Rectangle {
                        height: 26px;
                        width: parent.width;
                        background: Math.mod(i, 2) == 0 ? #ffffff : #f9f9f9;
                        Text {
                            text: item;
                            color: #555555;
                            font-size: 12px;
                            x: 8px;
                            vertical-alignment: center;
                            overflow: elide;
                            width: parent.width - 16px;
                        }
                    }
                }
            }
        }

        // 3. åº•éƒ¨æŽ§åˆ¶æ 
        GroupBox {
            title: "Settings & Actions";
            vertical-stretch: 0;

            HorizontalBox {
                spacing: 20px;
                padding: 8px;
                alignment: center; // å±…ä¸­å¯¹é½

                HorizontalBox {
                    spacing: 10px;
                    CheckBox {
                        text: "*.org~";
                        checked: root.org_enabled;
                        toggled => {
                            root.action_text = "Scan"
                        }
                    }

                    CheckBox {
                        text: "*.html~";
                        checked: root.html_enabled;
                        toggled => {
                            root.action_text = "Scan"
                        }
                    }

                    CheckBox {
                        text: ".DS_Store";
                        checked: root.dsstore_enabled;
                        toggled => {
                            root.action_text = "Scan"
                        }
                    }
                }

                // å ä½ç¬¦
                Rectangle {
                    horizontal-stretch: 1;
                }

                Button {
                    text: root.action_text;
                    width: 120px;
                    height: 36px;
                    primary: true;
                    clicked => {
                        root.action_clicked()
                    }
                }
            }
        }
    }
}
